<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Knockoff Demo</title>
    </head>
    <body>
        <h1>Knockoff Demo</h1>

        <h2>
            Character Sheet for <span data-mapping="name" id="nameSpan"></span>
        </h2>
        <p>
            Name: <input data-mapping="name" id="nameInput" type="text">
        </p>
        <p>
            Level: <input data-mapping="level" id="levelInput" type="text">
        </p>
        <p>
           <input data-mapping="undead" id="undeadInput" type="checkbox"> Undead
        </p>
        <p>
            Race:
            <select data-mapping="race" id="raceSelect">
                <option value="">Select one...</option>
                <option value="Human">Human</option>
                <option value="Klingon">Klingon</option>
                <option value="Vulcan">Vulcan</option>
            </select>
        </p>
        <p>
            Description:<br>
            <textarea data-mapping="description" id="descriptionTextarea"></textarea>
        </p>

        <h2>Skills</h2>
        <table>
            <tr>
                <th>Skill</th>
                <th>Day</th>
                <th>Night</th>
            </tr>
            <tr>
                <td>Programming</td>
                <td><input data-mapping="skills.programming.day" id="skillsProgrammingDayInput" type="text"></td>
                <td><input data-mapping="skills.programming.night" id="skillsProgrammingNightInput" type="text"></td>
            </tr>
            <tr>
                <td>Underwater Basket Weaving</td>
                <td><input data-mapping="skills.underwaterBasketWeaving.day" id="skillsUnderwaterBasketWeavingDayInput" type="text"></td>
                <td><input data-mapping="skills.underwaterBasketWeaving.night" id="skillsUnderwaterBasketWeavingNightInput" type="text"></td>
            </tr>
        </table>

        <h2>Powers</h2>
        <table>
            <tr>
                <th>Power</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><input data-mapping="powers.0.name" id="powers0NameInput"></td>
                <td><input data-mapping="powers.0.description" id="powers0DescriptionInput"></td>
            </tr>
            <tr>
                <td><input data-mapping="powers.1.name" id="powers1NameInput"></td>
                <td><input data-mapping="powers.1.description" id="powers1DescriptionInput"></td>
            </tr>
        </table>

        <h2>Attributes</h2>
        <table id="attributesTable">
            <tr>
                <th>Attribute</th>
                <th>Score</th>
            </tr>
        </table>

        <script src="js/KO-1.0.30.js"></script>
        <script>
            // ECMAScript 5 strict mode
            'use strict';

            var model = {
                name: 'Dave',
                level: 10,
                undead: true,
                race: 'Human',
                description: 'As a young boy, Dave created lego masterpieces and wrestled alligators. This is why he only has one arm...',
                skills: {
                    programming: { day: 10, night: 20 },
                    underwaterBasketWeaving: { day: 1, night: 2 }
                },
                powers: [
                    { name: 'Flurry of Keystrokes', description: 'You can type up to 80 word per minute.' },
                    { name: 'Telekenesis', description: 'You can move a pebble-sized object with your brain once per day.' }
                ]
            };

            KO.bind(model);

            model.attributes = {
                strength: 4,
                wisdom: 6,
                charisma: 20
            };

            model.totalAttributes = 30;

            document.getElementById('attributesTable').insertRow().innerHTML = '<tr><td>Strength</td><td><input data-mapping="attributes.strength" id="attributesStrengthInput"></td></tr>';
            document.getElementById('attributesTable').insertRow().innerHTML = '<tr><td>Wisdom</td><td><input data-mapping="attributes.wisdom" id="attributesWisdomInput"></td></tr>';
            document.getElementById('attributesTable').insertRow().innerHTML = '<tr><td>Charisma</td><td><input data-mapping="attributes.charisma" id="attributesCharismaInput"></td></tr>';

            KO.bind(model);

            KO.listen('level', function (event) {
                model.attributes.strength = model.level / 2;
            });

            KO.listen(['attributes.strength', 'attributes.wisdom', 'attributes.charisma'], function (event) {
                model.totalAttributes = model.attributes.strength + model.attributes.wisdom + model.attributes.charisma;
            });

            KO.listen(/skills\.(.*)\.day/, function (event, match) {
                var skill = match[1];

                model.skills[skill].night = event.detail.newValue * 2;
            });

            KO.validate('level', function (event) {
                return event.detail.newValue > 0;
            });

            KO.validate(['attributes.strength', 'attributes.wisdom', 'attributes.charisma'], function (event) {
                return model.totalAttributes + event.detail.newValue < 100;
            });

            KO.validate(/powers\.(\d+)\.name/, function (event, match) {
                var power = parseInt(match[1]);

                return !(power === 0 && event.detail.newValue === 'Ninja Flipping');
            });
        </script>
    </body>
</html>

